# Strace Provider Data - System call tracer
version: "1.0"

provider:
  name: "strace"
  display_name: "System Call Tracer"
  description: "Trace system calls and signals"
  type: "trace"
  platforms: ["linux"]
  capabilities: ["trace", "attach", "filter", "count", "time", "network", "files", "processes"]

actions:
  trace:
    description: "Trace system calls"
    template: "strace {{trace_options}} {{saidata.commands[0].path if saidata.commands else saidata.metadata.name}} 2>&1 | tee {{trace_output}}"
    variables:
      trace_options: "-f -t -e trace=all"
      trace_output: "/tmp/strace-{{saidata.metadata.name}}.log"

  attach:
    description: "Attach to running process"
    template: "strace {{attach_options}} -p $(pgrep -f {{saidata.metadata.name}}) 2>&1 | tee {{trace_output}}"
    variables:
      attach_options: "-f -t -e trace=all"
      trace_output: "/tmp/strace-attach-{{saidata.metadata.name}}.log"

  filter:
    description: "Trace specific system calls"
    template: "strace -e trace={{syscall_filter}} {{saidata.commands[0].path if saidata.commands else saidata.metadata.name}} 2>&1 | tee {{trace_output}}"
    variables:
      syscall_filter: "open,read,write,close"
      trace_output: "/tmp/strace-filtered-{{saidata.metadata.name}}.log"

  count:
    description: "Count system calls"
    template: "strace -c {{saidata.commands[0].path if saidata.commands else saidata.metadata.name}} 2>&1 | tee {{count_output}}"
    variables:
      count_output: "/tmp/strace-count-{{saidata.metadata.name}}.log"

  time:
    description: "Time system calls"
    template: "strace -T -tt {{saidata.commands[0].path if saidata.commands else saidata.metadata.name}} 2>&1 | tee {{time_output}}"
    variables:
      time_output: "/tmp/strace-time-{{saidata.metadata.name}}.log"

  network:
    description: "Trace network-related calls"
    template: "strace -e trace=network {{saidata.commands[0].path if saidata.commands else saidata.metadata.name}} 2>&1 | tee {{network_output}}"
    variables:
      network_output: "/tmp/strace-network-{{saidata.metadata.name}}.log"

  files:
    description: "Trace file operations"
    template: "strace -e trace=file {{saidata.commands[0].path if saidata.commands else saidata.metadata.name}} 2>&1 | tee {{files_output}}"
    variables:
      files_output: "/tmp/strace-files-{{saidata.metadata.name}}.log"

  processes:
    description: "Trace process management"
    template: "strace -e trace=process {{saidata.commands[0].path if saidata.commands else saidata.metadata.name}} 2>&1 | tee {{processes_output}}"
    variables:
      processes_output: "/tmp/strace-processes-{{saidata.metadata.name}}.log"
