# Trivy Provider Data - Comprehensive security scanner
version: "1.0"

provider:
  name: "trivy"
  display_name: "Trivy Security Scanner"
  description: "Comprehensive security scanner for containers, filesystems, and more"
  type: "security"
  platforms: ["linux", "macos", "windows"]
  capabilities: ["image", "filesystem", "repository", "config", "secret", "license", "sbom"]

actions:
  image:
    description: "Scan container image"
    template: "trivy image {{scan_options}} {{image_name}} -o {{output_format}} --output {{image_output}}"
    variables:
      scan_options: "--severity HIGH,CRITICAL"
      image_name: "{{sai_package(saidata) or saidata.metadata.name}}:{{sai_package(saidata, 0, "version") or \'latest\'}}"
      output_format: "json"
      image_output: "/tmp/trivy-image-{{saidata.metadata.name}}.json"

  filesystem:
    description: "Scan filesystem"
    template: "trivy fs {{scan_options}} {{scan_path}} -o {{output_format}} --output {{fs_output}}"
    variables:
      scan_options: "--severity HIGH,CRITICAL"
      scan_path: "{{sai_file(saidata, 0, "path") or \'/tmp\'}}"
      output_format: "json"
      fs_output: "/tmp/trivy-fs-{{saidata.metadata.name}}.json"

  repository:
    description: "Scan git repository"
    template: "trivy repo {{scan_options}} {{repo_url}} -o {{output_format}} --output {{repo_output}}"
    variables:
      scan_options: "--severity HIGH,CRITICAL"
      repo_url: "{{saidata.urls.repository}}"
      output_format: "json"
      repo_output: "/tmp/trivy-repo-{{saidata.metadata.name}}.json"

  config:
    description: "Scan configuration files"
    template: "trivy config {{scan_options}} {{config_path}} -o {{output_format}} --output {{config_output}}"
    variables:
      scan_options: "--severity HIGH,CRITICAL"
      config_path: "{{sai_file(saidata, 1, "path") or \'/etc\'}}"
      output_format: "json"
      config_output: "/tmp/trivy-config-{{saidata.metadata.name}}.json"

  secret:
    description: "Scan for secrets"
    template: "trivy fs --scanners secret {{scan_path}} -o {{output_format}} --output {{secret_output}}"
    variables:
      scan_path: "{{sai_file(saidata, 0, "path") or \'/tmp\'}}"
      output_format: "json"
      secret_output: "/tmp/trivy-secrets-{{saidata.metadata.name}}.json"

  license:
    description: "Scan for license compliance"
    template: "trivy fs --scanners license {{scan_path}} -o {{output_format}} --output {{license_output}}"
    variables:
      scan_path: "{{sai_file(saidata, 0, "path") or \'/tmp\'}}"
      output_format: "json"
      license_output: "/tmp/trivy-licenses-{{saidata.metadata.name}}.json"

  sbom:
    description: "Generate SBOM"
    template: "trivy image {{image_name}} --format spdx-json --output {{sbom_output}}"
    variables:
      image_name: "{{sai_package(saidata) or saidata.metadata.name}}:{{sai_package(saidata, 0, "version") or \'latest\'}}"
      sbom_output: "/tmp/trivy-sbom-{{saidata.metadata.name}}.json"
