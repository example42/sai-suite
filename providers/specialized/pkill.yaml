# PKILL Provider Data - Kill processes by name/criteria
version: "1.0"

provider:
  name: "pkill"
  display_name: "Process Kill"
  description: "Kill processes by name or criteria using pkill"
  type: "process"
  platforms: ["linux", "macos"]
  capabilities: ["stop", "restart", "status", "info"]

actions:
  stop:
    description: "Kill processes by name"
    template: "pkill -f {{saidata.metadata.name}}"
    validation:
      command: "! pgrep -f {{saidata.metadata.name}}"
      expected_exit_code: 0

  restart:
    description: "Kill and restart processes"
    steps:
      - name: "kill-process"
        command: "pkill -f {{saidata.metadata.name}}"
        ignore_failure: true
      - name: "wait-termination"
        command: "sleep {{restart_delay}}"
      - name: "start-process"
        command: "{{saidata.commands.server.path}} &"
    variables:
      restart_delay: "2"

  status:
    description: "Check process status before kill"
    template: "pgrep -f {{saidata.metadata.name}} && echo 'Process found' || echo 'Process not found'"

  info:
    description: "Show processes that would be killed"
    template: "pgrep -a -f {{saidata.metadata.name}}"

mappings:
  packages:
    server:
      name: "{{saidata.metadata.name}}"

  services:
    main:
      name: "{{saidata.metadata.name}}"
      type: "process_target"

  files:
    log:
      path: "/tmp/pkill-{{saidata.metadata.name}}.log"
      owner: "$(whoami)"
      group: "$(whoami)"
      mode: "0644"

  directories:
    process:
      path: "/tmp/process-{{saidata.metadata.name}}"
      owner: "$(whoami)"
      group: "$(whoami)"
      mode: "0755"

  commands:
    server:
      path: "{{saidata.commands.server.path}}"
    kill:
      path: "pkill -f {{saidata.metadata.name}}"

  variables:
    "*":
      config_key: "{{variable_name}}"