# KILLALL Provider Data - Kill processes by name
version: "1.0"

provider:
  name: "killall"
  display_name: "Kill All Processes"
  description: "Kill processes by name using killall command"
  type: "process"
  platforms: ["linux", "macos", "windows"]
  capabilities: ["stop", "restart", "status", "info"]

actions:
  stop:
    description: "Kill all processes by name"
    template: "killall {{kill_signal}} {{saidata.metadata.name}}"
    variables:
      kill_signal: "-TERM"
    validation:
      command: "! pgrep -f {{saidata.metadata.name}}"
      expected_exit_code: 0

  restart:
    description: "Kill and restart all processes"
    steps:
      - name: "kill-processes"
        command: "killall {{kill_signal}} {{saidata.metadata.name}}"
        ignore_failure: true
        variables:
          kill_signal: "-TERM"
      - name: "wait-termination"
        command: "sleep {{restart_delay}}"
      - name: "force-kill-if-needed"
        command: "killall -KILL {{saidata.metadata.name}}"
        ignore_failure: true
      - name: "start-process"
        command: "{{saidata.commands[0].path if saidata.commands else saidata.metadata.name}} &"
    variables:
      restart_delay: "3"

  status:
    description: "Check processes before killing"
    template: "pgrep -f {{saidata.metadata.name}} && echo 'Processes found' || echo 'No processes found'"

  info:
    description: "Show processes that would be killed"
    template: "pgrep -a -f {{saidata.metadata.name}}"
