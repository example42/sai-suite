# Grype Provider Data - Vulnerability scanner
version: "1.0"

provider:
  name: "grype"
  display_name: "Grype Vulnerability Scanner"
  description: "Scan for vulnerabilities in container images and filesystems"
  type: "security"
  platforms: ["linux", "macos", "windows"]
  capabilities: ["scan", "report", "filter", "export", "update", "check"]

actions:
  scan:
    description: "Scan for vulnerabilities"
    template: "grype {{scan_target}} -o {{output_format}} --file {{scan_output}}"
    variables:
      scan_target: "{{sai_file(saidata, 0, "path") or \'/tmp\'}}"
      output_format: "json"
      scan_output: "/tmp/grype-{{saidata.metadata.name}}.json"

  report:
    description: "Generate vulnerability report"
    template: "grype {{scan_target}} -o table --file {{report_output}}"
    variables:
      scan_target: "{{sai_file(saidata, 0, "path") or \'/tmp\'}}"
      report_output: "/tmp/grype-report-{{saidata.metadata.name}}.txt"

  filter:
    description: "Scan with severity filter"
    template: "grype {{scan_target}} --fail-on {{severity_level}} -o table --file {{filtered_output}}"
    variables:
      scan_target: "{{sai_file(saidata, 0, "path") or \'/tmp\'}}"
      severity_level: "high"
      filtered_output: "/tmp/grype-filtered-{{saidata.metadata.name}}.txt"

  export:
    description: "Export scan results in multiple formats"
    steps:
      - name: "export-json"
        command: "grype {{scan_target}} -o json --file {{export_dir}}/{{saidata.metadata.name}}-vulns.json"
      - name: "export-sarif"
        command: "grype {{scan_target}} -o sarif --file {{export_dir}}/{{saidata.metadata.name}}-vulns.sarif"
      - name: "export-table"
        command: "grype {{scan_target}} -o table --file {{export_dir}}/{{saidata.metadata.name}}-vulns.txt"
    variables:
      scan_target: "{{sai_file(saidata, 0, "path") or \'/tmp\'}}"
      export_dir: "/tmp/grype-export-{{saidata.metadata.name}}"

  update:
    description: "Update vulnerability database"
    template: "grype db update"

  check:
    description: "Check for specific CVE"
    template: "grype {{scan_target}} -o json | jq '.matches[] | select(.vulnerability.id == \"{{cve_id}}\")'"
    variables:
      scan_target: "{{sai_file(saidata, 0, "path") or \'/tmp\'}}"
      cve_id: "CVE-2023-1234"
