# PS Provider Data - Process status and management
version: "1.0"

provider:
  name: "ps"
  display_name: "Process Status"
  description: "Process status and management using ps command"
  type: "process"
  platforms: ["linux", "macos", "windows"]
  capabilities: ["list", "info", "status", "search", "stop"]

actions:
  list:
    description: "List processes"
    template: "ps {{ps_options}} | grep {{saidata.metadata.name}}"
    variables:
      ps_options: "aux"

  info:
    description: "Show detailed process information"
    template: "ps -p $(pgrep -f {{saidata.metadata.name}}) -o pid,ppid,user,cpu,mem,vsz,rss,tty,stat,start,time,command"

  status:
    description: "Check process status"
    template: "ps -p $(pgrep -f {{saidata.metadata.name}}) -o pid,stat,command"
    validation:
      command: "pgrep -f {{saidata.metadata.name}}"
      expected_exit_code: 0

  search:
    description: "Search for processes by name"
    template: "ps aux | grep {{search_pattern}}"
    variables:
      search_pattern: "{{saidata.metadata.name}}"

  stop:
    description: "Stop process using kill"
    template: "kill $(pgrep -f {{saidata.metadata.name}})"
    validation:
      command: "! pgrep -f {{saidata.metadata.name}}"
      expected_exit_code: 0

mappings:
  packages:
    server:
      name: "{{saidata.metadata.name}}"

  services:
    main:
      name: "{{saidata.metadata.name}}"
      type: "process_target"

  files:
    log:
      path: "/tmp/ps-{{saidata.metadata.name}}.log"
      owner: "$(whoami)"
      group: "$(whoami)"
      mode: "0644"

  directories:
    process:
      path: "/tmp/process-{{saidata.metadata.name}}"
      owner: "$(whoami)"
      group: "$(whoami)"
      mode: "0755"

  commands:
    server:
      path: "{{saidata.commands.server.path}}"
    list:
      path: "ps aux | grep {{saidata.metadata.name}}"

  variables:
    "*":
      config_key: "{{variable_name}}"